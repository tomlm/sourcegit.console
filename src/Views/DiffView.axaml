<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:m="using:SourceGit.Models"
             xmlns:vm="using:SourceGit.ViewModels"
             xmlns:v="using:SourceGit.Views"
             xmlns:c="using:SourceGit.Converters"
             xmlns:console="https://github.com/jinek/consolonia"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="SourceGit.Views.DiffView"
             x:DataType="vm:DiffContext">
  <Border BorderThickness="1" BorderBrush="{DynamicResource Brush.Border2}" Background="{DynamicResource Brush.Window}">
    <Grid RowDefinitions="{console:OnPlatform Default='26,*', Console='3,*'}">
      <!-- Toolbar -->
      <Border Grid.Row="0" BorderThickness="0,0,0,1" BorderBrush="{DynamicResource Brush.Border2}">
        <Grid ColumnDefinitions="Auto,Auto,*,Auto">
          <!-- File Icon -->
          <console:OnPlatform>
                        <console:OnPlatform.Default>
                          <Path Grid.Column="0" Width="12" Height="12" Data="{StaticResource Icons.File}" Margin="{console:OnPlatform Default='8,0,0,0', Console='1,0,0,0'}"/>
                        </console:OnPlatform.Default>
                        <console:OnPlatform.Console>
                          <TextBlock Grid.Column="0" Text="{StaticResource TextIcons.File}"/>
          </console:OnPlatform.Console>
          </console:OnPlatform>

          <!-- File Mode Change -->
          <Border Grid.Column="1"
                  Margin="{console:OnPlatform Default='4,0,0,0', Console='1,0,0,0'}"
                  Height="{console:OnPlatform Default='18', Console='1.8'}"
                  CornerRadius="{console:OnPlatform Default='4', Console='0'}"
                  VerticalAlignment="Center"
                  Background="{DynamicResource Brush.Badge}"
                  IsVisible="{Binding FileModeChange, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                  ToolTip.Tip="{DynamicResource Text.Diff.FileModeChanged}">
            <TextBlock Classes="primary" FontSize="10" HorizontalAlignment="Center" Margin="{console:OnPlatform Default='4,0', Console='1,0'}" Text="{Binding FileModeChange}" Foreground="{DynamicResource Brush.BadgeFG}"/>
          </Border>

          <!-- Title -->
          <TextBlock Grid.Column="2" Classes="primary" Margin="{console:OnPlatform Default='4,0,0,0', Console='1,0,0,0'}" Text="{Binding Title}" ToolTip.Tip="{Binding Title}" FontSize="11" TextTrimming="CharacterEllipsis"/>

          <!-- Toolbar Buttons -->
          <StackPanel Grid.Column="3" Margin="{console:OnPlatform Default='8,0,0,0', Console='1,0,0,0'}" Orientation="Horizontal" VerticalAlignment="Center">
            <Button Classes="icon_button"
                    Width="{console:OnPlatform Default='28', Console='2.8'}"
                    Click="OnGotoFirstChange"
                    IsVisible="{Binding IsTextDiff}"
                    HotKey="{OnPlatform Ctrl+Alt+Home, macOS=⌘+Alt+Home}">
              <ToolTip.Tip>
                <TextBlock>
                  <Run Text="{DynamicResource Text.Diff.First}"/>
                  <Run Text=" "/>
                  <Run Text="{OnPlatform Ctrl+Alt+Home, macOS=⌘+⌥+Home}" FontSize="11" Foreground="{DynamicResource MenuFlyoutItemKeyboardAcceleratorTextForeground}"/>
                </TextBlock>
              </ToolTip.Tip>
              <console:OnPlatform>
                                <console:OnPlatform.Default>
                                  <Path Width="12" Height="12" Stretch="Uniform" Margin="{console:OnPlatform Default='0,6,0,0', Console='0,1,0,0'}" Data="{StaticResource Icons.Top}"/>
                                </console:OnPlatform.Default>
                                <console:OnPlatform.Console>
                                  <TextBlock Text="{StaticResource TextIcons.Top}"/>
              </console:OnPlatform.Console>
              </console:OnPlatform>
            </Button>
            <!-- ... repeat for other buttons, wrapping Path as above and adjusting Width/Height/Margin ... -->
          </StackPanel>
        </Grid>
      </Border>

      <!-- Diff Contents -->
      <ContentControl Grid.Row="1" Content="{Binding Content}">
        <ContentControl.DataTemplates>
          <!-- Binary Diff -->
          <DataTemplate DataType="m:BinaryDiff">
            <StackPanel Orientation="Vertical" VerticalAlignment="Center">
              <TextBlock Text="{DynamicResource Text.Diff.Binary}"
                         Margin="{console:OnPlatform Default='0,0,0,32', Console='0,0,0,1'}"
                         FontSize="18" FontWeight="Bold"
                         Foreground="{DynamicResource Brush.FG2}"
                         HorizontalAlignment="Center"/>
              <console:OnPlatform>
                                <console:OnPlatform.Default>
                                  <Path Width="64" Height="64" Data="{StaticResource Icons.Binary}" Fill="{DynamicResource Brush.FG2}"/>
                                </console:OnPlatform.Default>
                                <console:OnPlatform.Console>
                                  <TextBlock Text="{StaticResource TextIcons.Binary}"/>
              </console:OnPlatform.Console>
              </console:OnPlatform>
              <Grid Margin="{console:OnPlatform Default='0,16,0,0', Console='0,1,0,0'}" HorizontalAlignment="Center" RowDefinitions="{console:OnPlatform Default='32,32', Console='3,3'}" ColumnDefinitions="Auto,Auto">
                <Border Grid.Row="0" Grid.Column="0" Height="{console:OnPlatform Default='16', Console='1.6'}" Background="{DynamicResource Brush.Badge}" CornerRadius="{console:OnPlatform Default='8', Console='0'}" VerticalAlignment="Center">
                  <TextBlock Classes="primary" Text="{DynamicResource Text.Diff.Old}" Margin="{console:OnPlatform Default='8,0', Console='1,0'}" FontSize="10" Foreground="{DynamicResource Brush.BadgeFG}"/>
                </Border>
                <TextBlock Grid.Row="0" Grid.Column="1" Classes="primary" Text="{Binding OldSize, Converter={x:Static c:LongConverters.ToFileSize}}" Foreground="{DynamicResource Brush.FG2}" HorizontalAlignment="Right" FontSize="16" Margin="{console:OnPlatform Default='8,0', Console='1,0'}"/>
                <Border Grid.Row="1" Grid.Column="0" Height="{console:OnPlatform Default='16', Console='1.6'}" Background="Green" CornerRadius="{console:OnPlatform Default='8', Console='0'}" VerticalAlignment="Center">
                  <TextBlock Classes="primary" Text="{DynamicResource Text.Diff.New}" Margin="{console:OnPlatform Default='8,0', Console='1,0'}" FontSize="10" Foreground="White"/>
                </Border>
                <TextBlock Grid.Row="1" Grid.Column="1" Classes="primary" Text="{Binding NewSize, Converter={x:Static c:LongConverters.ToFileSize}}" Foreground="{DynamicResource Brush.FG2}" HorizontalAlignment="Right" FontSize="16" Margin="{console:OnPlatform Default='8,0', Console='1,0'}"/>
              </Grid>
            </StackPanel>
          </DataTemplate>
          <!-- ... repeat for other DataTemplates, applying the same transformations ... -->
        </ContentControl.DataTemplates>
      </ContentControl>
    </Grid>
  </Border>
</UserControl>


